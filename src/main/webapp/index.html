<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>上市公司数据主页</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <style>
        #p1:hover,#p2:hover,#p3:hover,#p4:hover,#p5:hover,#p6 :hover{
            color: #00f2fe;
            text-decoration: #00f2fe;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row">
            <nav class="navbar navbar-inverse" role="navigation">
                <div class="navbar-header">
                    <a class="navbar-brand" href="index.html?page=1">上市公司财报展示</a>
                </div>
                <div id="userManageBtn" class="navbar-header navbar-right">
                    <a class="navbar-brand" href="usermanage.html">用户管理 </a>
                </div>
            </nav>
        </div>
        <div class="row">
            <br>
        </div>
        <div class="row">
            <div class="col-md-5">
                <strong style="font-size: large">上市公司全国分布</strong>
            </div>
            <div class="col-md-1">

            </div>
            <div class="col-md-5">
                <strong style="font-size: large">上市公司财务报表展示</strong>
            </div>
        </div>
        <div class="row">
            <div class="col-md-5">
            </div>
            <div class="col-md-1">

            </div>
            <div class="col-md-5">
                <br>
                <form id="financeForm">
                    <div class="form-group">
                        <label for="stock_code">公司代码</label>
                        <input type="text" class="form-control" id="stock_code" name="stock_code" placeholder="股票代码">
                    </div>
                    <div class="form-group">
                        <label for="finance_name">财务项</label>
                        <select class="form-control" id="finance_name" name="finance_name">
                            <option value="1">商誉</option>
                            <option value="2">资本公积</option>
                            <option value="3">盈余公积</option>
                            <option value="4">其他综合收益</option>
                        </select>
                    </div>
                    <div onclick="getFiance()"  class="btn btn-default">查询</div>
                </form>
            </div>
        </div>
        <div class="row">
            <div class="col-md-5">
                <div id="numberOfCity" style="width: 500px;height:400px;">

                </div>
            </div>
            <div class="col-md-1">

            </div>
            <div class="col-md-5">
                <div id="finaceOfCompany" style="width: 500px;height:400px;">

                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-1">
            </div>
            <div class="col-md-5">
                <button class="btn-primary" onclick="drawNumberOfCity()">
                    柱状图
                </button>
                <button class="btn-primary" onclick="drawNumberOfCity2()">
                    扇形图
                </button>
                <button class="btn-primary" onclick="drawNumberOfCity3()">
                    折线图
                </button>
            </div>
            <div class="col-md-5">
            </div>
            <div class="col-md-6">
            </div>
        </div>
        <div class="row">
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
        </div>

        <div class="row">
            <div class="col-md-9">
                <div class="row" style="width: 800px;height:400px;" id="lotsOfTables" name="lotsOfTables">

                </div>
                <div class="row">
                    <div class="col-md-3">

                    </div>
                    <div class="col-md-4">
                        <button class="btn-primary" onclick="changeTableType(1)">折线图</button>
                        <button class="btn-primary" onclick="changeTableType(2)">柱状图</button>
                        <button class="btn-primary" onclick="changeTableType(3)">扇形图</button>
                    </div>
                    <div class="col-md-5">

                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <p id="tableName" hidden="hidden">1</p>
                <p style="margin-top: 5px" id="p1" onclick="ChangeTableName(1)"><strong>公司总收入前五</strong></p>
                <p style="margin-top: 5px" id="p2" onclick="ChangeTableName(2)"><strong>公司净利率前五</strong></p>
                <p style="margin-top: 5px" id="p4" onclick="ChangeTableName(4)"><strong>公司总收入分布</strong></p>
                <p style="margin-top: 5px" id="p5" onclick="ChangeTableName(5)"><strong>公司净利润分布</strong></p>
            </div>
        </div>
        <div class="row">
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
        </div>
        <div class="row">
            <div class="row" >
                <table id="company_table" class="table table-hover">
                    <tr>
                        <th>序号</th>
                        <th>股票代码</th>
                        <th>股票简称</th>
                        <th>公司名称</th>
                        <th>省份</th>
                        <th>城市</th>
                        <th>主营业务收入</th>
                        <th>净利润</th>
                        <th>员工人数</th>
                        <th>上市日期</th>
                        <th>行业分类</th>
                        <th>主营业务</th>
                    </tr>
                </table>
            </div>
            <div class="row">
                <nav aria-label="Page navigation" id="page_nav">
                    <ul class="pagination" id="page_ul">
                        <li><a href="#">1</a></li>
                        <li><a href="#">2</a></li>
                        <li><a href="#">3</a></li>
                        <li><a href="#">4</a></li>
                        <li><a href="#">5</a></li>
                        <li><a href="#">...</a> </li>
                    </ul>
                </nav>
            </div>


        </div>

    </div>
    <script src="js/jquery-3.5.1.min.js"></script>
    <script src="js/echarts.min.js"></script>
    <script>
        var data1=[];
        var data2=[];
        drawNumberOfCity();
        ChangeTableName(1);
        showUserManage();
        drawFinaceOfCompany();
        drawPage(getUrlParam("page"));
        drawCompanyTable(getUrlParam("page"));

        function getFiance() {
            var data = $('#financeForm').serialize();
            console.log(data);
            $.ajax({
                type: "get",
                url: "/ssm/company/getCompanyFinave",
                data:data,
                success: function (data) {
                    console.log("succeed");
                    var data_of = [];
                    console.log(data);
                    var myChart = echarts.init(document.getElementById('finaceOfCompany'));
                    var option = {
                        xAxis: {
                            type: 'category',
                            data: [2020,2019,2018,2017,2016,2015,2014,2013,2012]
                        },
                        yAxis: {
                            type: 'value'
                        },
                        series: [{
                            data: [data.q,data.w,data.e,data.r,data.t,data.y,data.u,data.i,data.o],
                            type: 'line'
                        }]
                    }
                    myChart.setOption(option);
                },
                error: function(e) {
                    console.log(e.status);
                    console.log(e.responseText);
                }
            });
        }

        function showUserManage() {
            var nameEQ = "privilege=";
            var ca = document.cookie.split(';');
            var privilege;
            for (var i=0;i<ca.length;i++){
                var c = ca[i];
                while(c.charAt(0)==' ') c = c.substring(1,c.length);
                if (c.indexOf(nameEQ) == 0)
                    privilege = c.substring(nameEQ.length,c.length);
            }
            console.log("privilege=",privilege);
            if (privilege==2){
                console.log("hide");
                $('#userManageBtn').hide();
            }
        }
        function drawCompanyTable(page) {
            $.ajax({
                type: "get",
                url: "/ssm/company/getCompany?page="+page,
                success: function (data) {
                    $.each(data, function(i, item) {
                        code = ( "000000" + item.stock_code ).substr( -6 );
                        $('#company_table').append("<tr>" +
                            "<td>"+item.serial_number+"</td>" +
                            "<td>"+code+"</td>" +
                            "<td>"+item.stock_abbre+"</td>" +
                            "<td>"+item.company_name+"</td>" +
                            "<td>"+item.city+"</td>" +
                            "<td>"+item.area+"</td>" +
                            "<td>"+item.main_business_income+"</td>" +
                            "<td>"+item.net_profit+"</td>" +
                            "<td>"+item.employee+"</td>" +
                            "<td>"+item.listing_date+"</td>" +
                            "<td>"+item.industry_type+"</td>" +
                            "<td>"+item.main_business+"</td>" +
                            "</tr>")
                    })
                },
                error: function(e) {
                    console.log(e.status);
                    console.log(e.responseText);
                }
            });
        }

        function drawPage(page) {
            var p1 = parseInt(page);
            if (p1<3){
                p1 = 1;
                var p2 = 2;
                var p3 = 3;
                var p4 = 4;
                var p5 = 5;
            }else{
                var p2 = p1;
                p1 = p2 -1;
                var p3 = p2+1;
                var p4 = p3+1;
                var p5 = p4+1;
            }

            $('#page_ul').empty()
            $('#page_ul').append(
                "<li><a href=\"/ssm/index.html?page="+p1+"\">"+p1+"</a></li>" +
                "<li><a href=\"/ssm/index.html?page="+p2+"\">"+p2+"</a></li>" +
                "<li><a href=\"/ssm/index.html?page="+p3+"\">"+p3+"</a></li>" +
                "<li><a href=\"/ssm/index.html?page="+p4+"\">"+p4+"</a></li>" +
                "<li><a href=\"/ssm/index.html?page="+p5+"\">"+p5+"</a></li>" +
                "<li><a href=\"/ssm/index.html?page="+p1+"\">...</a></li>");
        }
        function getUrlParam(name) {
            //构造一个含有目标参数的正则表达式对象
            var reg = new RegExp("(^|&)"+name+"=([^&]*)(&|$)");
            //匹配目标参数
            var r = window.location.search.substr(1).match(reg);
            if (r != null) {
                return unescape(r[2]);
            } else {
                //返回参数值
                return "";
            }
        }

        function ChangeTableName(tableName) {
            var myChart = echarts.init(document.getElementById('lotsOfTables'));
            console.log(tableName);
            if (tableName==1){
                data1 = ['中国石化', '中国石油', '中国建筑', '中国平安', '中国人寿'];
                data2 = [15500, 14300, 10800, 9170, 6975];
            }else if (tableName==2){
                data1 = ['工商银行', '建设银行', '农业银行', '中国银行', '中国平安'];
                data2 = [2301, 2076, 1659, 1559, 1148];
            }else if (tableName==3){
            }else if (tableName==4){
                data1 = ['大于一万亿', '一千亿至一万亿', '一百亿至一千亿', '十亿至一百亿', '一亿至十亿', '零至一亿'];
                data2 = [3, 58, 410, 1899, 1636, 125];
            }else if (tableName==5){
                data1 = ['大于1000亿', '100亿至1000亿', '10亿至100亿', '1亿至10亿', '0至1亿', '小于0'];
                data2 = [5, 25, 400, 1562, 1883, 255];
            }else if (tableName==6){
            }
            var option = {
                xAxis: {
                    type: 'category',
                    data: data1
                },
                yAxis: {
                    type: 'value'
                },
                series: [{
                    data: data2,
                    type: 'line'
                }]
            }
            myChart.setOption(option);
        }

        function changeTableType(tableType) {
            var myChart = echarts.init(document.getElementById('lotsOfTables'));
            var option;
            if (tableType==1){
                option = {
                    xAxis: {
                        type: 'category',
                        data: data1
                    },
                    yAxis: {
                        type: 'value'
                    },
                    series: [{
                        data: data2,
                        type: 'line'
                    }]
                }
            }else if (tableType==2){
                option = {
                    xAxis: {
                        type: 'category',
                        data: data1
                    },
                    yAxis: {
                        type: 'value'
                    },
                    series: [{
                        data: data2,
                        type: 'bar'
                    }]
                };
            }else if (tableType==3){
                option = {
                    series : [
                        {
                            type: 'pie',
                            radius: '55%',
                            data:[
                                {value:data2[0], name:data1[0]},
                                {value:data2[1], name:data1[1]},
                                {value:data2[2], name:data1[2]},
                                {value:data2[3], name:data1[3]},
                                {value:data2[4], name:data1[4]}
                            ],
                            itemStyle: {
                                // 阴影的大小
                                shadowBlur: 200,
                                // 阴影水平方向上的偏移
                                shadowOffsetX: 0,
                                // 阴影垂直方向上的偏移
                                shadowOffsetY: 0,
                                // 阴影颜色
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        },
                    ]
                };
            }
            myChart.setOption(option);
        }

        function drawNumberOfCity2() {
            // 基于准备好的dom，初始化echarts实例
            var myChart = echarts.init(document.getElementById('numberOfCity'));
            myChart.setOption({
                series : [
                    {
                        type: 'pie',
                        radius: '55%',
                        data:[
                            {value:305, name:'北京'},
                            {value:273, name:'深证'},
                            {value:265, name:'上海'},
                            {value:128, name:'杭州'},
                            {value:99, name:'苏州'},
                            {value:3059,name:'其他地区'}
                        ],
                        itemStyle: {
                            // 阴影的大小
                            shadowBlur: 200,
                            // 阴影水平方向上的偏移
                            shadowOffsetX: 0,
                            // 阴影垂直方向上的偏移
                            shadowOffsetY: 0,
                            // 阴影颜色
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    },
                ]
            })
        }

        function drawNumberOfCity3() {
            var myChart = echarts.init(document.getElementById('numberOfCity'));
            var option = {
                xAxis: {
                    type: 'category',
                    data: ['北京', '深圳', '上海', '杭州', '苏州']
                },
                yAxis: {
                    type: 'value'
                },
                series: [{
                    data: [305, 273, 265, 128, 99],
                    type: 'line'
                }]
            };
            myChart.setOption(option);
        }

        function drawNumberOfCity() {
            // 基于准备好的dom，初始化echarts实例

            $.ajax({
                type: "get",
                url: "/ssm/company/getNumberOfCity",
                success: function (data) {
                    var myChart = echarts.init(document.getElementById('numberOfCity'));
                    var city = [];
                    var number = [];
                    $.each(data, function(i, item) {
                        if (i<5){
                            console.log(item,item.city,item.number);
                            city.push(item.city);
                            number.push(item.number);
                        }
                    })
                    var option = {
                        // title: {
                        //     text: '城市上市公司数量排行'
                        // },
                        tooltip: {},
                        // legend: {
                        //     data:['公司数量']
                        // },
                        xAxis: {
                            data: city
                        },
                        yAxis: {},
                        series: [{
                            name: '公司数量',
                            type: 'bar',
                            data: number
                        }],
                        itemStyle: {
                            // 阴影的大小
                            shadowBlur: 200,
                            // 阴影水平方向上的偏移
                            shadowOffsetX: 0,
                            // 阴影垂直方向上的偏移
                            shadowOffsetY: 0,
                            // 阴影颜色
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    };
                    myChart.setOption(option);
                },
                error: function(e) {
                    console.log(e.status);
                    console.log(e.responseText);
                }
            });
        }

        function drawFinaceOfCompany() {
            // 基于准备好的dom，初始化echarts实例
            var myChart = echarts.init(document.getElementById('finaceOfCompany'));

            // 指定图表的配置项和数据
            var option = {
                // title: {
                //     text: '城市上市公司数量排行'
                // },
                tooltip: {},
                // legend: {
                //     data:['公司数量']
                // },
                xAxis: {
                    data: [2020,2019,2018,2017,2016]
                },
                yAxis: {},
                series: [{
                    type: 'line',
                    data: []
                }]
            };

            // 使用刚指定的配置项和数据显示图表。
            myChart.setOption(option);
        }
        var num =1 ;

        function getF() {

            num = (num+1)%4
            var data2 = [];
            if (num==1){
                data2 = [77,56,54,67,55]
            }else if (num==2){
                data2 = [67,56,45,57,45]
            }else if (num==3){
                data2 = [65,45,23,45,32]
            }else if (num==0){
                data2 = [56,34,45,65,34]
            }else {
                data2 = [67,45,34,54,34]
            }
            // 基于准备好的dom，初始化echarts实例
            var myChart = echarts.init(document.getElementById('finaceOfCompany'));

            // 指定图表的配置项和数据
            var option = {
                // title: {
                //     text: '城市上市公司数量排行'
                // },
                tooltip: {},
                // legend: {
                //     data:['公司数量']
                // },
                xAxis: {
                    data: [2020,2019,2018,2017,2016]
                },
                yAxis: {},
                series: [{
                    type: 'line',
                    data: data2
                }]
            };

            // 使用刚指定的配置项和数据显示图表。
            myChart.setOption(option);
        }
    </script>
</body>
</html>